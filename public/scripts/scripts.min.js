function setCookie(a,d,b){var e=new Date();e.setDate(e.getDate()+b);var c=d+((b==null)?"":"; expires="+e.toUTCString());document.cookie=a+"="+c}function getCookie(b){var c,a,e,d=document.cookie.split(";");for(c=0;c<d.length;c++){a=d[c].substr(0,d[c].indexOf("="));e=d[c].substr(d[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a==b){return e}}}var App={events:[],latlng:[58.383836,12.32256],zoom:7,map:undefined,markers:[],popups:[],category:[],layers:[],Init:function(){App.map=L.map("map").setView(App.latlng,App.zoom);L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:"Trafikinformation hämtad från sverigesradio.se"}).addTo(App.map);$("#event-list").click(function(a){a.preventDefault();var b=$(a.target).data("id");if(b!==undefined){$("body").removeClass("active");App.map.panTo(App.markers[b].getLatLng());App.markers[b].openPopup(App.popups[b])}});$(".category-option").click(function(b){b.preventDefault();var a=$(b.target);var c=a.data("category");a.toggleClass("show");if(c!==undefined&&App.category[c]!=undefined){$("#event-list li[data-category='"+c+"']").toggle();App.category[c].forEach(function(d){if(a.hasClass("show")){App.map.addLayer(d)}else{App.map.removeLayer(d)}})}});$("#event_controller").click(function(a){$("body").toggleClass("active")});App.UpdateEvents();App.GetLocation()},UpdateEvents:function(){function a(b){App.events=b;App.DrawUI()}$.ajax({url:"api/Traffic",success:a})},HasLocation:function(){return getCookie("geolocation")},SaveLocation:function SaveLocation(a){setCookie("geolocation",JSON.stringify(a),100)},GetLocation:function(){if(App.HasLocation()==undefined){if("geolocation" in navigator){navigator.geolocation.getCurrentPosition(function(a){App.latlng=[a.coords.latitude,a.coords.longitude];App.map.panTo(App.latlng)})}}else{App.map.panTo(JSON.parse(App.HasLocation()))}},DrawUI:function(){var b=$("#event-list");var a=[1,2,3,4,5];for(i=1;i<=5;i++){var c=L.Icon.Default.extend({options:{iconUrl:"/images/marker-icon-"+i+".png"}});a[i]=new c()}App.events.forEach(function(f){b.prepend('<li data-category="'+f.category+'"><a href="#" class="event-link priority-'+f.priority+'" data-id="'+f.id+'">'+f.title+' <span class="subcategory">('+f.category+"/"+f.subcategory+")</span></a></li>");var e=L.marker([f.latitude,f.longitude],{draggable:false,title:f.title,icon:a[f.priority]});if(App.category[f.category]==undefined){App.category[f.category]=[]}App.category[f.category][f.id]=e;App.map.addLayer(e);App.markers[f.id]=e;var d=L.popup();d.setContent(App.getMarkerHTML(f));e.bindPopup(d);App.popups[f.id]=d})},getMarkerHTML:function(b){function c(d){return d<10?"0"+d:d}var a=new Date(b.created);return'<p class="date">'+a.getUTCFullYear()+"-"+c(a.getUTCMonth())+"-"+c(a.getUTCDate())+" "+c(a.getHours())+":"+c(a.getMinutes())+"</p><h2>"+b.subcategory+"</h2><h3>"+b.title+'</h3><p class="description">'+b.description+"</p>"}};$(function(){if(L!=undefined){App.Init()}else{alert("could not load map")}});